<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1934px" preserveAspectRatio="none" style="width:1588px;height:1934px;" version="1.1" viewBox="0 0 1588 1934" width="1588px" zoomAndPan="magnify"><defs><filter height="300%" id="fonvkqsvoh6l0" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[4a77e03bc18691b8919b6eaee68b6397]
cluster support--><polygon fill="#FFFFFF" filter="url(#fonvkqsvoh6l0)" points="16,102,168,102,175,124.4883,1009,124.4883,1009,391,16,391,16,102" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="16" x2="175" y1="124.4883" y2="124.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="146" x="20" y="117.5352">core.handler.support</text><!--MD5=[02ce43ee6c19eec9361f331a4e96450d]
cluster executor--><polygon fill="#FFFFFF" filter="url(#fonvkqsvoh6l0)" points="285,440,442,440,449,462.4883,832,462.4883,832,581,285,581,285,440" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="285" x2="449" y1="462.4883" y2="462.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="151" x="289" y="455.5352">core.handler.executor</text><!--MD5=[7f1db14b27b7629509c802e44e13c9c4]
cluster context--><polygon fill="#FFFFFF" filter="url(#fonvkqsvoh6l0)" points="285,630,434,630,441,652.4883,706,652.4883,706,1181,285,1181,285,630" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="285" x2="441" y1="652.4883" y2="652.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="143" x="289" y="645.5352">core.handler.context</text><!--MD5=[f12f832c3ac0603ce526ef171d08d9c6]
cluster base--><polygon fill="#FFFFFF" filter="url(#fonvkqsvoh6l0)" points="746,714,869,714,876,736.4883,1170,736.4883,1170,1122.5,746,1122.5,746,714" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="746" x2="876" y1="736.4883" y2="736.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="117" x="750" y="729.5352">core.handle.base</text><!--MD5=[5336d0432c5753478f8bb0248199b33b]
cluster handler--><polygon fill="#FFFFFF" filter="url(#fonvkqsvoh6l0)" points="607,1378,733,1378,740,1400.4883,1571,1400.4883,1571,1927,607,1927,607,1378" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="607" x2="740" y1="1400.4883" y2="1400.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="120" x="611" y="1393.5352">core.handler.http</text><!--MD5=[46f2c292e41020ccd6cfa91fa9d63f8f]
class Handlers--><rect codeLine="8" fill="#FEFECE" filter="url(#fonvkqsvoh6l0)" height="86.8652" id="Handlers" style="stroke:#A80036;stroke-width:1.5;" width="926" x="40" y="145"/><ellipse cx="472.75" cy="161" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M475.2231,167.1431 Q474.6421,167.4419 474.0029,167.5913 Q473.3638,167.7407 472.6582,167.7407 Q470.1514,167.7407 468.8315,166.0889 Q467.5117,164.437 467.5117,161.3159 Q467.5117,158.1865 468.8315,156.5347 Q470.1514,154.8828 472.6582,154.8828 Q473.3638,154.8828 474.0112,155.0322 Q474.6587,155.1816 475.2231,155.4805 L475.2231,158.2031 Q474.5923,157.6221 473.9988,157.3523 Q473.4053,157.0825 472.7744,157.0825 Q471.4297,157.0825 470.7449,158.1492 Q470.0601,159.2158 470.0601,161.3159 Q470.0601,163.4077 470.7449,164.4744 Q471.4297,165.541 472.7744,165.541 Q473.4053,165.541 473.9988,165.2712 Q474.5923,165.0015 475.2231,164.4204 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="52" x="493.25" y="165.5352">Handlers</text><line style="stroke:#A80036;stroke-width:1.5;" x1="41" x2="965" y1="177" y2="177"/><line style="stroke:#A80036;stroke-width:1.5;" x1="41" x2="965" y1="185" y2="185"/><ellipse cx="51" cy="196" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="390" x="60" y="199.6348">static &lt;N extends Base&gt; AbstractHandler&lt;N&gt; createHandlerFor(N node)</text><ellipse cx="51" cy="208.9551" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="548" x="60" y="212.5898">static &lt;R&gt; R createSupportHandlerFor(Class&lt;? extends Base&gt; forNodeClass, Class&lt;?&gt; selectorClass)</text><ellipse cx="51" cy="221.9102" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="900" x="60" y="225.5449">static &lt;N extends Base&gt; AbstractHandler&lt;N&gt; createCompositionHandlerFor(N node, Class&lt;? extends Base&gt; forNodeClass, Class&lt;? extends Base&gt; selectorNodeClass)</text><!--MD5=[7baceaf4d78f1e030a3874b4c56ae591]
class scanner--><rect codeLine="14" fill="#FEFECE" filter="url(#fonvkqsvoh6l0)" height="73.9102" id="scanner" style="stroke:#A80036;stroke-width:1.5;" width="538" x="234" y="293"/><ellipse cx="415.25" cy="309" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M417.7231,315.1431 Q417.1421,315.4419 416.5029,315.5913 Q415.8638,315.7407 415.1582,315.7407 Q412.6514,315.7407 411.3315,314.0889 Q410.0117,312.437 410.0117,309.3159 Q410.0117,306.1865 411.3315,304.5347 Q412.6514,302.8828 415.1582,302.8828 Q415.8638,302.8828 416.5112,303.0322 Q417.1587,303.1816 417.7231,303.4805 L417.7231,306.2031 Q417.0923,305.6221 416.4988,305.3523 Q415.9053,305.0825 415.2744,305.0825 Q413.9297,305.0825 413.2449,306.1492 Q412.5601,307.2158 412.5601,309.3159 Q412.5601,311.4077 413.2449,312.4744 Q413.9297,313.541 415.2744,313.541 Q415.9053,313.541 416.4988,313.2712 Q417.0923,313.0015 417.7231,312.4204 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="167" x="435.75" y="313.5352">Handlers.NodeFactoryHolder</text><line style="stroke:#A80036;stroke-width:1.5;" x1="235" x2="771" y1="325" y2="325"/><polygon fill="none" points="245,332,241,338,249,338" style="stroke:#1963A0;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="40" x="254" y="339.6348">static {}</text><line style="stroke:#A80036;stroke-width:1.5;" x1="235" x2="771" y1="345.9551" y2="345.9551"/><polygon fill="#4177AF" points="245,352.9551,241,358.9551,249,358.9551" style="stroke:#1963A0;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="512" x="254" y="360.5898">static Set&lt;Class&lt;? extends AbstractHandler&gt;&gt; nodeHandlerDiscovery(String... packageNames)</text><!--MD5=[a0a1f7f9662f43ef0ece806266f72a6f]
class Executor--><rect codeLine="23" fill="#FEFECE" filter="url(#fonvkqsvoh6l0)" height="73.9102" id="Executor" style="stroke:#A80036;stroke-width:1.5;" width="480" x="328" y="483"/><ellipse cx="538.75" cy="499" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M541.2231,505.1431 Q540.6421,505.4419 540.0029,505.5913 Q539.3638,505.7407 538.6582,505.7407 Q536.1514,505.7407 534.8315,504.0889 Q533.5117,502.437 533.5117,499.3159 Q533.5117,496.1865 534.8315,494.5347 Q536.1514,492.8828 538.6582,492.8828 Q539.3638,492.8828 540.0112,493.0322 Q540.6587,493.1816 541.2231,493.4805 L541.2231,496.2031 Q540.5923,495.6221 539.9988,495.3523 Q539.4053,495.0825 538.7744,495.0825 Q537.4297,495.0825 536.7449,496.1492 Q536.0601,497.2158 536.0601,499.3159 Q536.0601,501.4077 536.7449,502.4744 Q537.4297,503.541 538.7744,503.541 Q539.4053,503.541 539.9988,503.2712 Q540.5923,503.0015 541.2231,502.4204 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="50" x="559.25" y="503.5352">Executor</text><line style="stroke:#A80036;stroke-width:1.5;" x1="329" x2="807" y1="515" y2="515"/><line style="stroke:#A80036;stroke-width:1.5;" x1="329" x2="807" y1="523" y2="523"/><ellipse cx="339" cy="534" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="294" x="348" y="537.6348">static &lt;N extends Base&gt; Execution instanceOf(N node)</text><ellipse cx="339" cy="546.9551" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="454" x="348" y="550.5898">static &lt;N extends Base&gt; ExecutionContext execute(N node, ExecutionContext input)</text><!--MD5=[b8f9c9f402fdb0639661b25476f0741f]
class ExecutionContext--><rect codeLine="30" fill="#FEFECE" filter="url(#fonvkqsvoh6l0)" height="229.3711" id="ExecutionContext" style="stroke:#A80036;stroke-width:1.5;" width="354" x="328" y="673"/><ellipse cx="451.25" cy="689" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M453.7231,695.1431 Q453.1421,695.4419 452.5029,695.5913 Q451.8638,695.7407 451.1582,695.7407 Q448.6514,695.7407 447.3315,694.0889 Q446.0117,692.437 446.0117,689.3159 Q446.0117,686.1865 447.3315,684.5347 Q448.6514,682.8828 451.1582,682.8828 Q451.8638,682.8828 452.5112,683.0322 Q453.1587,683.1816 453.7231,683.4805 L453.7231,686.2031 Q453.0923,685.6221 452.4988,685.3523 Q451.9053,685.0825 451.2744,685.0825 Q449.9297,685.0825 449.2449,686.1492 Q448.5601,687.2158 448.5601,689.3159 Q448.5601,691.4077 449.2449,692.4744 Q449.9297,693.541 451.2744,693.541 Q451.9053,693.541 452.4988,693.2712 Q453.0923,693.0015 453.7231,692.4204 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="99" x="471.75" y="693.5352">ExecutionContext</text><line style="stroke:#A80036;stroke-width:1.5;" x1="329" x2="681" y1="705" y2="705"/><ellipse cx="339" cy="716" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="172" x="348" y="719.6348">static ExecutionContext empty()</text><ellipse cx="339" cy="728.9551" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="277" x="348" y="732.5898">static ExecutionContext of(ExecutionContext input)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="329" x2="681" y1="738.9102" y2="738.9102"/><ellipse cx="339" cy="749.9102" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="311" x="348" y="753.5449">ExecutionContext join(ExecutionContext anotherContext)</text><ellipse cx="339" cy="762.8652" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="99" x="348" y="766.5">Services services()</text><ellipse cx="339" cy="775.8203" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="294" x="348" y="779.4551">ExecutionContext globalState(Object key, Object value)</text><ellipse cx="339" cy="788.7754" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="328" x="348" y="792.4102">&lt;R&gt; R globalStateIfAbsent(Object key, Supplier&lt;R&gt; supplier)</text><ellipse cx="339" cy="801.7305" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="172" x="348" y="805.3652">Map&lt;String, Object&gt; variables()</text><ellipse cx="339" cy="814.6855" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="141" x="348" y="818.3203">Object variable(String key)</text><ellipse cx="339" cy="827.6406" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="274" x="348" y="831.2754">ExecutionContext variable(String key, Object value)</text><ellipse cx="339" cy="840.5957" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="261" x="348" y="844.2305">ExecutionContext state(Object key, Object value)</text><ellipse cx="339" cy="853.5508" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="147" x="348" y="857.1855">&lt;R&gt; R state(Class&lt;R&gt; key)</text><ellipse cx="339" cy="866.5059" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="128" x="348" y="870.1406">&lt;R&gt; R state(Object key)</text><ellipse cx="339" cy="879.4609" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="154" x="348" y="883.0957">void releaseState(Object key)</text><ellipse cx="339" cy="892.416" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="281" x="348" y="896.0508">ExecutionContext merge(ExecutionContext context)</text><!--MD5=[456b5dcdd3523bcda4108ba1c5f6c640]
class ExecutionContext.Builder--><rect codeLine="48" fill="#FEFECE" filter="url(#fonvkqsvoh6l0)" height="177.5508" id="ExecutionContext.Builder" style="stroke:#A80036;stroke-width:1.5;" width="311" x="349.5" y="979"/><ellipse cx="429.25" cy="995" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M431.7231,1001.1431 Q431.1421,1001.4419 430.5029,1001.5913 Q429.8638,1001.7407 429.1582,1001.7407 Q426.6514,1001.7407 425.3315,1000.0889 Q424.0117,998.437 424.0117,995.3159 Q424.0117,992.1865 425.3315,990.5347 Q426.6514,988.8828 429.1582,988.8828 Q429.8638,988.8828 430.5112,989.0322 Q431.1587,989.1816 431.7231,989.4805 L431.7231,992.2031 Q431.0923,991.6221 430.4988,991.3523 Q429.9053,991.0825 429.2744,991.0825 Q427.9297,991.0825 427.2449,992.1492 Q426.5601,993.2158 426.5601,995.3159 Q426.5601,997.4077 427.2449,998.4744 Q427.9297,999.541 429.2744,999.541 Q429.9053,999.541 430.4988,999.2712 Q431.0923,999.0015 431.7231,998.4204 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="143" x="449.75" y="999.5352">ExecutionContext.Builder</text><line style="stroke:#A80036;stroke-width:1.5;" x1="350.5" x2="659.5" y1="1011" y2="1011"/><line style="stroke:#A80036;stroke-width:1.5;" x1="350.5" x2="659.5" y1="1019" y2="1019"/><ellipse cx="360.5" cy="1030" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="183" x="369.5" y="1033.6348">Builder services(Services services)</text><ellipse cx="360.5" cy="1042.9551" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="219" x="369.5" y="1046.5898">Builder services(ExecutionContext input)</text><ellipse cx="360.5" cy="1055.9102" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="285" x="369.5" y="1059.5449">Builder globalState(Map&lt;Object, Object&gt; globalState)</text><ellipse cx="360.5" cy="1068.8652" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="234" x="369.5" y="1072.5">Builder globalState(ExecutionContext input)</text><ellipse cx="360.5" cy="1081.8203" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="260" x="369.5" y="1085.4551">Builder variables(Map&lt;String, Object&gt; variables)</text><ellipse cx="360.5" cy="1094.7754" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="223" x="369.5" y="1098.4102">Builder variables(ExecutionContext input)</text><ellipse cx="360.5" cy="1107.7305" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="219" x="369.5" y="1111.3652">Builder state(Map&lt;Object, Object&gt; state)</text><ellipse cx="360.5" cy="1120.6855" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="201" x="369.5" y="1124.3203">Builder state(ExecutionContext input)</text><ellipse cx="360.5" cy="1133.6406" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="186" x="369.5" y="1137.2754">Builder of(ExecutionContext input)</text><ellipse cx="360.5" cy="1146.5957" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="134" x="369.5" y="1150.2305">ExecutionContext build()</text><!--MD5=[c38b041ce756cbe16ae0cf6e4cd53481]
class Execution--><rect codeLine="65" fill="#FEFECE" filter="url(#fonvkqsvoh6l0)" height="60.9551" id="Execution" style="stroke:#A80036;stroke-width:1.5;" width="315" x="804.5" y="757"/><ellipse cx="930.25" cy="773" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M926.6777,769.2651 L926.6777,767.1069 L934.0571,767.1069 L934.0571,769.2651 L931.5918,769.2651 L931.5918,777.3418 L934.0571,777.3418 L934.0571,779.5 L926.6777,779.5 L926.6777,777.3418 L929.1431,777.3418 L929.1431,769.2651 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="55" x="950.75" y="777.5352">Execution</text><line style="stroke:#A80036;stroke-width:1.5;" x1="805.5" x2="1118.5" y1="789" y2="789"/><line style="stroke:#A80036;stroke-width:1.5;" x1="805.5" x2="1118.5" y1="797" y2="797"/><ellipse cx="815.5" cy="808" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="289" x="824.5" y="811.6348">ExecutionContext execute(ExecutionContext context)</text><!--MD5=[01b95d182fe8d23fc8b232b64dd5b18e]
class AbstractHandler--><rect codeLine="69" fill="#FEFECE" filter="url(#fonvkqsvoh6l0)" height="60.9551" id="AbstractHandler" style="stroke:#A80036;stroke-width:1.5;" width="368" x="778" y="1037.5"/><ellipse cx="863.75" cy="1053.5" fill="#A9DCDF" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M863.6133,1048.8481 L862.4595,1053.9199 L864.7754,1053.9199 Z M862.1191,1046.6069 L865.1157,1046.6069 L868.4609,1059 L866.0122,1059 L865.2485,1055.937 L861.9697,1055.937 L861.2227,1059 L858.7739,1059 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="94" x="884.25" y="1058.0352">AbstractHandler</text><rect fill="#FFFFFF" height="16.1328" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" width="92" x="1057" y="1034.5"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="90" x="1058" y="1047.1016">N extends Base</text><line style="stroke:#A80036;stroke-width:1.5;" x1="779" x2="1145" y1="1069.5" y2="1069.5"/><line style="stroke:#A80036;stroke-width:1.5;" x1="779" x2="1145" y1="1077.5" y2="1077.5"/><polygon fill="#4177AF" points="789,1084.5,785,1090.5,793,1090.5" style="stroke:#1963A0;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="342" x="798" y="1092.1348">ExecutionContext configureContext(ExecutionContext context)</text><!--MD5=[f2f72a8a22143fdabb500f8432b91e61]
class AbstractNodeHandler--><rect codeLine="83" fill="#FEFECE" filter="url(#fonvkqsvoh6l0)" height="60.9551" id="AbstractNodeHandler" style="stroke:#A80036;stroke-width:1.5;" width="262" x="831" y="1421"/><ellipse cx="846" cy="1437" fill="#A9DCDF" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M845.8633,1432.3481 L844.7095,1437.4199 L847.0254,1437.4199 Z M844.3691,1430.1069 L847.3657,1430.1069 L850.7109,1442.5 L848.2622,1442.5 L847.4985,1439.437 L844.2197,1439.437 L843.4727,1442.5 L841.0239,1442.5 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="125" x="860" y="1441.5352">AbstractNodeHandler</text><rect fill="#FFFFFF" height="16.1328" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" width="103" x="993" y="1418"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="93" x="998" y="1430.6016">T extends Node</text><line style="stroke:#A80036;stroke-width:1.5;" x1="832" x2="1092" y1="1453" y2="1453"/><line style="stroke:#A80036;stroke-width:1.5;" x1="832" x2="1092" y1="1461" y2="1461"/><ellipse cx="842" cy="1472" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="161" x="851" y="1475.6348">AbstractNodeHandler(T node)</text><!--MD5=[ae82d90ea9f28f9a75f5a462d4509c47]
class OperationHandler--><rect codeLine="86" fill="#FEFECE" filter="url(#fonvkqsvoh6l0)" height="198.5059" id="OperationHandler" style="stroke:#A80036;stroke-width:1.5;" width="908" x="639" y="1543"/><ellipse cx="975.75" cy="1559" fill="#A9DCDF" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M975.6133,1554.3481 L974.4595,1559.4199 L976.7754,1559.4199 Z M974.1191,1552.1069 L977.1157,1552.1069 L980.4609,1564.5 L978.0122,1564.5 L977.2485,1561.437 L973.9697,1561.437 L973.2227,1564.5 L970.7739,1564.5 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="103" x="996.25" y="1563.5352">OperationHandler</text><rect fill="#FFFFFF" height="16.1328" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" width="121" x="1429" y="1540"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="119" x="1430" y="1552.6016">T extends Operation</text><line style="stroke:#A80036;stroke-width:1.5;" x1="640" x2="1546" y1="1575" y2="1575"/><polygon fill="#4177AF" points="650,1582,646,1588,654,1588" style="stroke:#1963A0;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="555" x="659" y="1589.6348">static void copyInputHeadersToRequestBuilder(ExecutionContext input, Request.Builder requestBuilder)</text><polygon fill="#4177AF" points="650,1594.9551,646,1600.9551,654,1600.9551" style="stroke:#1963A0;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="658" x="659" y="1602.5898">static void copyNodeHeadersToRequestBuilder(Operation node, ExecutionContext context, Request.Builder requestBuilder)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="640" x2="1546" y1="1608.9102" y2="1608.9102"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="647" y="1616.9102"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="250" x="659" y="1623.5449">String evaluatedUrl(ExecutionContext context)</text><polygon fill="#4177AF" points="650,1628.8652,646,1634.8652,654,1634.8652" style="stroke:#1963A0;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="230" x="659" y="1636.5">int beforeRequest(ExecutionContext input)</text><polygon fill="#4177AF" points="650,1641.8203,646,1647.8203,654,1647.8203" style="stroke:#1963A0;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="525" x="659" y="1649.4551">Response doRequest(ExecutionContext input, int requestTimeout, Request.Builder requestBuilder)</text><polygon fill="#4177AF" points="650,1654.7754,646,1660.7754,654,1660.7754" style="stroke:#1963A0;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="433" x="659" y="1662.4102">ExecutionContext handleResponse(ExecutionContext input, Response response)</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="647" y="1668.7305"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="882" x="659" y="1675.3652">private Response sendAndRetryRequestOnError(ExecutionContext context, Client client, Request request, int requestTimeout, int retryCount, int napOnRetryInMillis)</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="647" y="1681.6855"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="742" x="659" y="1688.3203">private Response executeRequest(ExecutionContext context, Client client, Request request, int requestTimeout, boolean inRetryWhileState)</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="647" y="1694.6406"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="511" x="659" y="1701.2754">private void validateResponse(ExecutionContext context, Request request, Response response)</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="647" y="1707.5957"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="139" x="659" y="1714.2305">private void nap(int millis)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="640" x2="1546" y1="1720.5508" y2="1720.5508"/><ellipse cx="650" cy="1731.5508" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="289" x="659" y="1735.1855">ExecutionContext execute(ExecutionContext context)</text><!--MD5=[b9b8c6612922766dbf3276cb0fc8b2c2]
class GetHandler--><rect codeLine="101" fill="#FEFECE" filter="url(#fonvkqsvoh6l0)" height="99.8203" id="GetHandler" style="stroke:#A80036;stroke-width:1.5;" width="302" x="942" y="1803"/><ellipse cx="1039.75" cy="1819" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1042.2231,1825.1431 Q1041.6421,1825.4419 1041.0029,1825.5913 Q1040.3638,1825.7407 1039.6582,1825.7407 Q1037.1514,1825.7407 1035.8315,1824.0889 Q1034.5117,1822.437 1034.5117,1819.3159 Q1034.5117,1816.1865 1035.8315,1814.5347 Q1037.1514,1812.8828 1039.6582,1812.8828 Q1040.3638,1812.8828 1041.0112,1813.0322 Q1041.6587,1813.1816 1042.2231,1813.4805 L1042.2231,1816.2031 Q1041.5923,1815.6221 1040.9988,1815.3523 Q1040.4053,1815.0825 1039.7744,1815.0825 Q1038.4297,1815.0825 1037.7449,1816.1492 Q1037.0601,1817.2158 1037.0601,1819.3159 Q1037.0601,1821.4077 1037.7449,1822.4744 Q1038.4297,1823.541 1039.7744,1823.541 Q1040.4053,1823.541 1040.9988,1823.2712 Q1041.5923,1823.0015 1042.2231,1822.4204 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="66" x="1060.25" y="1823.5352">GetHandler</text><rect fill="#FFFFFF" height="16.1328" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" width="30" x="1217" y="1800"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="20" x="1222" y="1812.6016">Get</text><line style="stroke:#A80036;stroke-width:1.5;" x1="943" x2="1243" y1="1835" y2="1835"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="167" x="948" y="1849.6348">@Handler(forClass = Get.class)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="943" x2="1243" y1="1855.9551" y2="1855.9551"/><ellipse cx="953" cy="1866.9551" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="116" x="962" y="1870.5898">GetHandler(Get node)</text><ellipse cx="953" cy="1879.9102" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="276" x="962" y="1883.5449">ExecutionContext execute(ExecutionContext input)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="965" y="1896.5"/><path d="M848.5,6 L848.5,46.6211 L1153.5,46.6211 L1153.5,16 L1143.5,6 L848.5,6 " fill="#FBFB77" filter="url(#fonvkqsvoh6l0)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1143.5,6 L1143.5,16 L1153.5,16 L1143.5,6 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="284" x="854.5" y="23.5684">Node Handler discovery is triggered by static</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="854.5" y="38.8789">initialization at runtime.</text><path d="M469.5,1236 L469.5,1322.5527 L760.5,1322.5527 L760.5,1246 L750.5,1236 L469.5,1236 " fill="#FBFB77" filter="url(#fonvkqsvoh6l0)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M750.5,1236 L750.5,1246 L760.5,1246 L750.5,1236 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="475.5" y="1253.5684">The Handler is stateful and is created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="475.5" y="1268.8789">for each node-execution at runtime.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="479.5" y="1284.1895"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="475.5" y="1299.5">This example demonstrates use of Handler</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="475.5" y="1314.8105">for a Http Get operation.</text><!--MD5=[19aee03508efa9a4bec6989d1c9b1e2b]
link GMN279 to support--><path d="M1001,47.12 C1001,57.635 1001,71.4762 1001,86.3698 C1001,90.0932 1001,93.8824 1001,97.7018 C1001,98.6567 1001,99.6134 1001,100.5715 C1001,100.811 1001,101.0506 1001,101.2903 " fill="none" id="GMN279-support" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><!--MD5=[4e61358d8abcafa5bd0cacce0cbbac85]
reverse link Handlers to scanner--><path codeLine="19" d="M503,245.24 C503,261.24 503,278.27 503,292.76 " fill="none" id="Handlers-backto-scanner" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="503,232.11,499,238.11,503,244.11,507,238.11,503,232.11" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[d871a3de79db30f55418a7c0f52ed8aa]
reverse link ExecutionContext to ExecutionContext.Builder--><path codeLine="61" d="M505,907.29 C505,931.29 505,956.12 505,978.85 " fill="none" id="ExecutionContext-backto-ExecutionContext.Builder" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="505,902.18,501,911.18,505,907.18,509,911.18,505,902.18" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="510" y="945.5684">build()</text><!--MD5=[adf5fab647bad8347ea1c469a201606b]
reverse link Execution to AbstractHandler--><path d="M962,838.31 C962,896.2 962,989.85 962,1037.34 " fill="none" id="Execution-backto-AbstractHandler" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="955,838.04,962,818.04,969,838.04,955,838.04" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[f2e630215b61fcd0212353b74c1cbe9f]
link GMN296 to handler--><path d="M615,1323.4 C615,1335.7925 615,1349.7831 615,1363.8347 C615,1367.3476 615,1370.8643 615,1374.3608 C615,1375.2349 615,1376.1077 615,1376.979 C615,1377.1968 615,1377.4145 615,1377.6321 " fill="none" id="GMN296-handler" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><!--MD5=[2551c99dc05230a95e7a969f69833701]
reverse link AbstractHandler to AbstractNodeHandler--><path codeLine="109" d="M953.07,1118.72 C947.46,1199.25 948.03,1355.73 954.78,1420.9 " fill="none" id="AbstractHandler-backto-AbstractNodeHandler" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="946.11,1117.96,954.77,1098.62,960.06,1119.14,946.11,1117.96" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[67b7ee240799a88192b13125af56daa9]
link AbstractHandler to AbstractNodeHandler--><!--MD5=[d5bfa55a1b30530b4ef88ab29c2aac9c]
reverse link AbstractNodeHandler to OperationHandler--><path codeLine="110" d="M993.98,1498.63 C1003.35,1512.16 1013.99,1527.5 1024.72,1542.99 " fill="none" id="AbstractNodeHandler-backto-OperationHandler" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="988.11,1502.46,982.47,1482.03,999.62,1494.48,988.11,1502.46" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[7750d886bb0e7a03892349d41225d540]
reverse link OperationHandler to GetHandler--><path codeLine="111" d="M1093,1762.46 C1093,1776.66 1093,1790.49 1093,1802.86 " fill="none" id="OperationHandler-backto-GetHandler" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="1086,1762.25,1093,1742.25,1100,1762.25,1086,1762.25" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[c23434db23b374fa636b7f6f72b8891e]
link executor to context--><!--MD5=[69b35cefe71ca946e981b026470c02fb]
link context to base--><!--MD5=[a3fa4f911a047cec3443ca87c6a21e22]
link support to base--><!--MD5=[6a5d1bfea6bcac4591cd1eb034f0c7e2]
link support to handler--><!--MD5=[d9b8176763b0dcba26f3c80084dc5dee]
@startuml

note top of support
Node Handler discovery is triggered by static
initialization at runtime.
end note

package "core.handler.support" as support {
    class Handlers {
        +static <N extends Base> AbstractHandler<N> createHandlerFor(N node)
        +static <R> R createSupportHandlerFor(Class<? extends Base> forNodeClass, Class<?> selectorClass)
        +static <N extends Base> AbstractHandler<N> createCompositionHandlerFor(N node, Class<? extends Base> forNodeClass, Class<? extends Base> selectorNodeClass)
    }

    class "Handlers.NodeFactoryHolder" as scanner {
        ~static {}
        ~static Set<Class<? extends AbstractHandler>> nodeHandlerDiscovery(String... packageNames)
    }

    Handlers *.. scanner
}

package "core.handler.executor" as executor {
    class Executor {
        +static <N extends Base> Execution instanceOf(N node)
        +static <N extends Base> ExecutionContext execute(N node, ExecutionContext input)
    }
}

package "core.handler.context" as context {
    class ExecutionContext {
        +static ExecutionContext empty()
        +static ExecutionContext of(ExecutionContext input)
        - -
        +ExecutionContext join(ExecutionContext anotherContext)
        +Services services()
        +ExecutionContext globalState(Object key, Object value)
        +<R> R globalStateIfAbsent(Object key, Supplier<R> supplier)
        +Map<String, Object> variables()
        +Object variable(String key)
        +ExecutionContext variable(String key, Object value)
        +ExecutionContext state(Object key, Object value)
        +<R> R state(Class<R> key)
        +<R> R state(Object key)
        +void releaseState(Object key)
        +ExecutionContext merge(ExecutionContext context)
    }

    class ExecutionContext.Builder {
        +Builder services(Services services)
        +Builder services(ExecutionContext input)
        +Builder globalState(Map<Object, Object> globalState)
        +Builder globalState(ExecutionContext input)
        +Builder variables(Map<String, Object> variables)
        +Builder variables(ExecutionContext input)
        +Builder state(Map<Object, Object> state)
        +Builder state(ExecutionContext input)
        +Builder of(ExecutionContext input)
        +ExecutionContext build()
    }

    ExecutionContext <.. ExecutionContext.Builder : " build()"
}

package "core.handle.base" as base {
    interface Execution {
        +ExecutionContext execute(ExecutionContext context)
    }

    abstract class AbstractHandler<N extends Base> implements Execution {
        ~ExecutionContext configureContext(ExecutionContext context)
    }
}

note top of handler
The Handler is stateful and is created
for each node-execution at runtime.

This example demonstrates use of Handler
for a Http Get operation.
end note

package "core.handler.http" as handler {
    abstract class AbstractNodeHandler < T extends Node > {
        +AbstractNodeHandler(T node)
    }
    abstract class OperationHandler<T extends Operation> {
        ~static void copyInputHeadersToRequestBuilder(ExecutionContext input, Request.Builder requestBuilder)
        ~static void copyNodeHeadersToRequestBuilder(Operation node, ExecutionContext context, Request.Builder requestBuilder)
        - -
        -String evaluatedUrl(ExecutionContext context)
        ~int beforeRequest(ExecutionContext input)
        ~Response doRequest(ExecutionContext input, int requestTimeout, Request.Builder requestBuilder)
        ~ExecutionContext handleResponse(ExecutionContext input, Response response)
        -private Response sendAndRetryRequestOnError(ExecutionContext context, Client client, Request request, int requestTimeout, int retryCount, int napOnRetryInMillis)
        -private Response executeRequest(ExecutionContext context, Client client, Request request, int requestTimeout, boolean inRetryWhileState)
        -private void validateResponse(ExecutionContext context, Request request, Response response)
        -private void nap(int millis)
        - -
        +ExecutionContext execute(ExecutionContext context)
    }
    class GetHandler < Get > {
        @Handler(forClass = Get.class)
        - -
        +GetHandler(Get node)
        +ExecutionContext execute(ExecutionContext input)

    }

    AbstractNodeHandler -u-|> AbstractHandler
    OperationHandler -u-|> AbstractNodeHandler
    GetHandler -u-|> OperationHandler
}

'support -[hidden]- - executor
executor -[hidden]- context
context -[hidden] base
support -[hidden]- - base
support -[hidden]- - - - - - handler
AbstractHandler -[hidden]- - AbstractNodeHandler

@enduml

@startuml

note top of support
Node Handler discovery is triggered by static
initialization at runtime.
end note

package "core.handler.support" as support {
    class Handlers {
        +static <N extends Base> AbstractHandler<N> createHandlerFor(N node)
        +static <R> R createSupportHandlerFor(Class<? extends Base> forNodeClass, Class<?> selectorClass)
        +static <N extends Base> AbstractHandler<N> createCompositionHandlerFor(N node, Class<? extends Base> forNodeClass, Class<? extends Base> selectorNodeClass)
    }

    class "Handlers.NodeFactoryHolder" as scanner {
        ~static {}
        ~static Set<Class<? extends AbstractHandler>> nodeHandlerDiscovery(String... packageNames)
    }

    Handlers *.. scanner
}

package "core.handler.executor" as executor {
    class Executor {
        +static <N extends Base> Execution instanceOf(N node)
        +static <N extends Base> ExecutionContext execute(N node, ExecutionContext input)
    }
}

package "core.handler.context" as context {
    class ExecutionContext {
        +static ExecutionContext empty()
        +static ExecutionContext of(ExecutionContext input)
        - -
        +ExecutionContext join(ExecutionContext anotherContext)
        +Services services()
        +ExecutionContext globalState(Object key, Object value)
        +<R> R globalStateIfAbsent(Object key, Supplier<R> supplier)
        +Map<String, Object> variables()
        +Object variable(String key)
        +ExecutionContext variable(String key, Object value)
        +ExecutionContext state(Object key, Object value)
        +<R> R state(Class<R> key)
        +<R> R state(Object key)
        +void releaseState(Object key)
        +ExecutionContext merge(ExecutionContext context)
    }

    class ExecutionContext.Builder {
        +Builder services(Services services)
        +Builder services(ExecutionContext input)
        +Builder globalState(Map<Object, Object> globalState)
        +Builder globalState(ExecutionContext input)
        +Builder variables(Map<String, Object> variables)
        +Builder variables(ExecutionContext input)
        +Builder state(Map<Object, Object> state)
        +Builder state(ExecutionContext input)
        +Builder of(ExecutionContext input)
        +ExecutionContext build()
    }

    ExecutionContext <.. ExecutionContext.Builder : " build()"
}

package "core.handle.base" as base {
    interface Execution {
        +ExecutionContext execute(ExecutionContext context)
    }

    abstract class AbstractHandler<N extends Base> implements Execution {
        ~ExecutionContext configureContext(ExecutionContext context)
    }
}

note top of handler
The Handler is stateful and is created
for each node-execution at runtime.

This example demonstrates use of Handler
for a Http Get operation.
end note

package "core.handler.http" as handler {
    abstract class AbstractNodeHandler < T extends Node > {
        +AbstractNodeHandler(T node)
    }
    abstract class OperationHandler<T extends Operation> {
        ~static void copyInputHeadersToRequestBuilder(ExecutionContext input, Request.Builder requestBuilder)
        ~static void copyNodeHeadersToRequestBuilder(Operation node, ExecutionContext context, Request.Builder requestBuilder)
        - -
        -String evaluatedUrl(ExecutionContext context)
        ~int beforeRequest(ExecutionContext input)
        ~Response doRequest(ExecutionContext input, int requestTimeout, Request.Builder requestBuilder)
        ~ExecutionContext handleResponse(ExecutionContext input, Response response)
        -private Response sendAndRetryRequestOnError(ExecutionContext context, Client client, Request request, int requestTimeout, int retryCount, int napOnRetryInMillis)
        -private Response executeRequest(ExecutionContext context, Client client, Request request, int requestTimeout, boolean inRetryWhileState)
        -private void validateResponse(ExecutionContext context, Request request, Response response)
        -private void nap(int millis)
        - -
        +ExecutionContext execute(ExecutionContext context)
    }
    class GetHandler < Get > {
        @Handler(forClass = Get.class)
        - -
        +GetHandler(Get node)
        +ExecutionContext execute(ExecutionContext input)

    }

    AbstractNodeHandler -u-|> AbstractHandler
    OperationHandler -u-|> AbstractNodeHandler
    GetHandler -u-|> OperationHandler
}

executor -[hidden]- context
context -[hidden] base
support -[hidden]- - base
support -[hidden]- - - - - - handler
AbstractHandler -[hidden]- - AbstractNodeHandler

@enduml

PlantUML version 1.2020.26(Mon Dec 21 18:45:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: NO
--></g></svg>